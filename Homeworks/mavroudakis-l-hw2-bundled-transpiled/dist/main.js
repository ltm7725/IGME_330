(()=>{"use strict";const e=(e,t,r,n,c,a,l,o)=>{let s=e.createRadialGradient(t,r,n,c,a,l);for(let e of o)s.addColorStop(e.percent,e.color);return s};let t,r,n,c,a,l,o,s,u,i;const d=Object.freeze({gain:.5,numSamples:256});new Uint8Array(d.numSamples/2);let p,m,h,y,g,S,b,q,w,v=e=>{r.src=e},f=e=>{i=!1,e=Number(e),a.gain.value=e,document.querySelector("#volume-label").innerHTML=Math.round(50*e)+"%",document.querySelector("#volume-slider").value=e,document.querySelector("#volume-label").style.color=e>2?"orange":"rgb(202, 225, 230)"};class x{constructor(e,t,r,n,c="squares",a=0,l=0,o=!1){this.x=e,this.y=t,this.colors=r,this.maxScale=n,this.type=c,this.tiltAngle=a,this.totalRotation=l,this.devSprite=o,this.minScale=1e-4,this.done=[];for(let e=0;e<this.colors.length;e++)this.done[e]=!1;this.swapAngle=a}update(e){let[t,r,n,c]=e,a=this.minScale*(.9-(n-1)/this.colors.length*.9+.1),l=this.minScale*(.9-(n-1)/this.colors.length*.9+.1),o=a,s=l;return t+=this.tiltAngle,c.invInterp?"wav"==document.querySelector("#switch").choice?(o=a+r[Math.round(n/this.colors.length*127)]%127/255*(a/this.minScale*(this.maxScale-this.minScale)),s=l+r[Math.round(n/this.colors.length*127)]%127/255*(l/this.minScale*(this.maxScale-this.minScale)),this.devSprite&&(o*=2,s*=2),127!=r[Math.round(n/this.colors.length*127)]&&128!=r[Math.round(n/this.colors.length*127)]||(o=0,s=0)):(o=a+(1-r[Math.round(n/this.colors.length*127)]/255)*(a/this.minScale*(this.maxScale-this.minScale)),s=l+(1-r[Math.round(n/this.colors.length*127)]/255)*(l/this.minScale*(this.maxScale-this.minScale)),this.devSprite&&("squares"==this.type?(o*=3,s*=3):(o*=2.25,s*=2.25))):"wav"==document.querySelector("#switch").choice?(o=a+r[Math.round(n/this.colors.length*127)]/255*(a/this.minScale*(this.maxScale-this.minScale)),s=l+r[Math.round(n/this.colors.length*127)]/255*(l/this.minScale*(this.maxScale-this.minScale)),this.devSprite&&(o*=1.5,s*=1.5),127!=r[Math.round(n/this.colors.length*127)]&&128!=r[Math.round(n/this.colors.length*127)]||(o=0,s=0)):(o=a+r[Math.round(n/this.colors.length*127)]/255*(a/this.minScale*(this.maxScale-this.minScale)),s=l+r[Math.round(n/this.colors.length*127)]/255*(l/this.minScale*(this.maxScale-this.minScale)),0==r[6]&&(o=0,s=0)),c.drawVortex&&(o*=1.5,s*=1.5),[a,l,o,s,t]}draw(t,r,n){this.swapAngle!=this.tiltAngle&&(this.tiltAngle=Math.round(this.swapAngle));let c=-this.tiltAngle;for(let a=1;a<this.colors.length+1;a++){let l,o,s,u;[l,o,s,u,c]=this.update([c,r,a,n]),t.save(),t.translate(this.x,this.y),t.rotate(this.totalRotation/360*(2*Math.PI)),t.rotate(c/360*(2*Math.PI)),t.translate(this.minScale/2-s/2,this.minScale/2-u/2),("circles"==this.type&&n.showCircles||"squares"==this.type&&n.showSquares)&&("circles"==this.type?t.fillStyle=e(t,s/2,u/2,s/4,s/2,u/2,s/2,[{percent:.25,color:this.colors[a-1]},{percent:1,color:"transparent"}]):n.drawVortex?t.fillStyle=e(t,s/2,u/2,10,s/2,u/2,1.6*s,[{percent:.25,color:this.colors[a-1]},{percent:.325,color:"transparent"}]):t.fillStyle=e(t,s/2,u/2,10,s/2,u/2,1.6*s,[{percent:0,color:this.colors[a-1]},{percent:.9,color:"transparent"}]),t.beginPath(),t.fillRect(0,0,s,u),t.closePath(),t.fill()),t.restore()}}}let k,M,A,C,T,L,E,R=(e,t)=>{p=e.getContext("2d"),m=e.width,h=e.height,b=new x(m/2,h/2,["magenta","cyan","purple","rgb(0,128,255)","magenta","cyan","purple","rgb(0,128,255)","magenta","cyan","purple","rgb(0,128,255)","magenta","cyan","purple","rgb(0,128,255)","magenta","cyan","purple","rgb(0,128,255)","magenta","cyan","purple","rgb(0,128,255)","magenta","cyan","purple","rgb(0,128,255)","magenta","cyan","purple","rgb(0,128,255)","magenta","cyan","purple","rgb(0,128,255)","magenta","cyan","purple","rgb(0,128,255)","magenta","cyan","purple","rgb(0,128,255)","magenta","cyan","purple","rgb(0,128,255)","magenta","cyan","purple","rgb(0,128,255)","magenta","cyan","purple","rgb(0,128,255)","magenta","cyan","purple","rgb(0,128,255)","magenta","cyan","purple","rgb(0,128,255)","magenta","cyan","purple","rgb(0,128,255)","magenta","cyan","purple","rgb(0,128,255)","magenta","cyan","purple","rgb(0,128,255)","magenta","cyan","purple","rgb(0,128,255)","magenta","cyan","purple","rgb(0,128,255)","magenta","cyan","purple","rgb(0,128,255)","magenta","cyan","purple","rgb(0,128,255)","magenta","cyan","purple","rgb(0,128,255)","magenta","cyan","purple","rgb(0,128,255)","magenta","cyan","purple","rgb(0,128,255)","magenta","cyan","purple","rgb(0,128,255)","magenta","cyan","purple","rgb(0,128,255)","magenta","cyan","purple","rgb(0,128,255)","magenta","cyan","purple","rgb(0,128,255)","magenta","cyan","purple","rgb(0,128,255)","magenta","cyan","purple","rgb(0,128,255)","magenta","cyan","purple","rgb(0,128,255)","magenta","cyan","purple","rgb(0,128,255)","magenta","cyan","purple","rgb(0,128,255)","magenta","cyan","purple","rgb(0,128,255)","magenta","cyan","purple","rgb(0,128,255)","magenta","cyan","purple","rgb(0,128,255)","magenta","cyan","purple","rgb(0,128,255)","magenta","cyan","purple","rgb(0,128,255)","magenta","cyan","purple","rgb(0,128,255)","magenta","cyan","purple","rgb(0,128,255)","magenta","cyan","purple","rgb(0,128,255)","magenta","cyan","purple","rgb(0,128,255)","magenta","cyan","purple","rgb(0,128,255)","magenta","cyan","purple","rgb(0,128,255)","magenta","cyan","purple","rgb(0,128,255)","magenta","cyan","purple","rgb(0,128,255)","magenta","cyan","purple","rgb(0,128,255)","magenta","cyan","purple","rgb(0,128,255)","magenta","cyan","purple","rgb(0,128,255)","magenta","cyan","purple","black"],200,"squares",46,0,!0),q=new x(m/2,h/2,["cyan","magenta","yellow","purple","cyan","magenta","yellow","purple","cyan","magenta","yellow","purple"],700,"circles",0,0,!0);let r=document.querySelector("#square-angle-slider"),n=document.querySelector("#square-angle-label");r.oninput=e=>{b.swapAngle=r.value,n.innerHTML=r.value+"Â°"},w=window.matchMedia("(max-height: 94.55vw)"),w.addEventListener("change",(()=>{(e=>{let t=document.querySelector("#switch-div"),r=document.querySelector("#bottom-controls"),n=document.querySelector("#checkboxes"),c=document.querySelector("#controls-button"),a=document.querySelector("#pop-controls");e.matches?(t.style.display="none",r.style.display="none",n.style.display="none"):("yes"==c.open&&(c.open="no",c.innerHTML="Open<br>Controls",a.style.display="none",document.querySelector("#controls").prepend(document.querySelector("#switch-div")),document.querySelector("#main-controls").appendChild(document.querySelector("#bottom-controls")),document.querySelector("#controls").appendChild(document.querySelector("#checkboxes"))),t.style.display="flex",r.style.display="block",n.style.display="flex")})(w)})),y=((e,t,r,n,c,a)=>{let l=e.createLinearGradient(0,0,0,c);for(let e of[{percent:0,color:"cyan"},{percent:.3125,color:"rgb(0,128,255)"},{percent:.6875,color:"rgb(128,0,255)"},{percent:1,color:"magenta"}])l.addColorStop(e.percent,e.color);return l})(p,0,0,0,h),g=t,S=new Uint8Array(g.fftSize/2)};const I=Object.freeze({sound1:"media/New Adventure Theme.mp3"}),F={invInterp:!1,showGradient:!0,showBars:!0,showCircles:!0,showSquares:!0,showNoise:!0,showInvert:!1,showEmboss:!1,drawVortex:!1};let H=e=>{e.matches?(0==F.showSquares&&(document.querySelector("#switch-div").style.transform="translate(0, 5.5vw)"),document.querySelectorAll("#checkboxes span")[0].appendChild(document.querySelector("#gradient-cb")),document.querySelectorAll("#checkboxes span")[1].appendChild(document.querySelector("#bars-cb")),document.querySelectorAll("#checkboxes span")[2].appendChild(document.querySelector("#circles-cb")),document.querySelectorAll("#checkboxes span")[3].appendChild(document.querySelector("#squares-cb")),document.querySelectorAll("#checkboxes span")[4].appendChild(document.querySelector("#noise-cb")),document.querySelectorAll("#checkboxes span")[5].appendChild(document.querySelector("#invert-cb")),document.querySelectorAll("#checkboxes span")[6].appendChild(document.querySelector("#emboss-cb"))):(0==F.showSquares&&(document.querySelector("#switch-div").style.transform="translate(0,-1vw)"),document.querySelectorAll("#checkboxes span")[0].prepend(document.querySelector("#gradient-cb")),document.querySelectorAll("#checkboxes span")[1].prepend(document.querySelector("#bars-cb")),document.querySelectorAll("#checkboxes span")[2].prepend(document.querySelector("#circles-cb")),document.querySelectorAll("#checkboxes span")[3].prepend(document.querySelector("#squares-cb")),document.querySelectorAll("#checkboxes span")[4].prepend(document.querySelector("#noise-cb")),document.querySelectorAll("#checkboxes span")[5].prepend(document.querySelector("#invert-cb")),document.querySelectorAll("#checkboxes span")[6].prepend(document.querySelector("#emboss-cb")))},z=e=>{document.querySelector("#fs-button").addEventListener("click",(t=>{var r;(r=e).requestFullscreen?r.requestFullscreen():r.mozRequestFullscreen?r.mozRequestFullscreen():r.mozRequestFullScreen?r.mozRequestFullScreen():r.webkitRequestFullscreen&&r.webkitRequestFullscreen()}));const n=document.querySelector("#play-button");n.addEventListener("click",(e=>{"suspended"==t.state&&t.resume(),"no"==e.target.dataset.playing?(r.play(),e.target.dataset.playing="yes"):(r.pause(),e.target.dataset.playing="no")}));const c=document.querySelector("#controls-button"),d=document.querySelector("#pop-controls"),p=document.querySelector("#controls"),m=document.querySelector("#main-controls");document.querySelector("#controls"),c.addEventListener("click",(e=>{"yes"==e.target.open?(e.target.open="no",e.target.innerHTML="Open<br>Controls",d.style.display="none",p.prepend(document.querySelector("#switch-div")),m.appendChild(document.querySelector("#bottom-controls")),p.appendChild(document.querySelector("#checkboxes")),document.querySelector("#switch-div").style.display="none",document.querySelector("#bottom-controls").style.display="none",document.querySelector("#checkboxes").style.display="none"):(e.target.open="yes",e.target.innerHTML="Close<br>Controls",d.appendChild(document.querySelector("#switch-div")),d.appendChild(document.querySelector("#bottom-controls")),d.appendChild(document.querySelector("#checkboxes")),document.querySelector("#switch-div").style.display="flex",document.querySelector("#bottom-controls").style.display="block",document.querySelector("#checkboxes").style.display="flex",d.style.display="flex")}));const h=document.querySelector("#switch"),y=document.querySelector("#switch-img");h.choice="freq",h.addEventListener("click",(()=>{"wav"==h.choice?(h.choice="freq",y.src="media/switch-up.png"):(h.choice="wav",y.src="media/switch-down.png")}));let g=document.querySelector("#volume-slider");document.querySelector("#volume-label"),A=document.querySelector("#treble-slider");let S=document.querySelector("#treble-label");C=document.querySelector("#bass-slider");let b=document.querySelector("#bass-label");T=document.querySelector("#distortion-slider");let q=document.querySelector("#distortion-label");k=0,M=0,g.oninput=e=>{f(e.target.value)},A.oninput=e=>{var r;k=A.value,A.value=(r=k,l.frequency.setValueAtTime(1e3,t.currentTime),l.gain.setValueAtTime(r/100*25,t.currentTime),Math.round(l.gain.value/25*100)!=r&&"yes"==document.querySelector("#play-button").dataset.playing?Math.round(l.gain.value/25*100):r),S.innerHTML=A.value+"%"},C.oninput=e=>{var r;M=C.value,C.value=(r=M,o.frequency.setValueAtTime(1e3,t.currentTime),o.gain.setValueAtTime(r/100*20,t.currentTime),Math.round(o.gain.value/20*100)!=r&&"yes"==document.querySelector("#play-button").dataset.playing?Math.round(o.gain.value/20*100):r),b.innerHTML=C.value+"%"},T.oninput=e=>{var t;t=T.value,distortion?(s.curve=null,s.curve=((e=20)=>{let t=new Float32Array(256);for(let r=0;r<256;++r){let n=2*r/256-1;t[r]=(Math.PI+e)*n/(Math.PI+e*Math.abs(n))}return t})(t),i||(u=a.gain.value,i=!0),f(t/12)):(s.curve=null,a.gain.value=Number(u),i=!1),q.innerHTML=T.value+"%"},g.dispatchEvent(new Event("input")),document.querySelector("#track-select").onchange=e=>{v(e.target.value),"yes"==n.dataset.playing&&n.dispatchEvent(new MouseEvent("click"))},document.querySelector("#inv-interp-switch").onchange=e=>{F.invInterp=e.target.checked},document.querySelector("#gradient-cb").onchange=e=>{F.showGradient=e.target.checked},document.querySelector("#bars-cb").onchange=e=>{F.showBars=e.target.checked},document.querySelector("#circles-cb").onchange=e=>{F.showCircles=e.target.checked},E=document.querySelector("#squares-cb"),E.onchange=e=>{F.showSquares=e.target.checked},document.querySelector("#noise-cb").onchange=e=>{F.showNoise=e.target.checked},document.querySelector("#invert-cb").onchange=e=>{F.showInvert=e.target.checked},document.querySelector("#emboss-cb").onchange=e=>{F.showEmboss=e.target.checked},document.querySelector("#vortex").onchange=e=>{F.drawVortex=e.target.checked}},B=()=>{setTimeout(B,1e3/L),((e={})=>{"wav"==document.querySelector("#switch").choice?g.getByteTimeDomainData(S):g.getByteFrequencyData(S),p.save(),p.fillStyle="black",p.globalAlpha=.1,p.fillRect(0,0,m,h),p.restore(),e.showGradient&&(p.save(),p.fillStyle=y,p.globalAlpha=.2,p.fillRect(0,0,m,h),p.restore()),q.draw(p,S,e);let t=p.getImageData(0,0,m,h),r=t.data,n=r.length,c=t.width;for(let t=0;t<n;t+=4)e.showNoise&&Math.random()<.05&&(r[t]=255-r[t],r[t+1]=255-r[t+1],r[t+2]=255-r[t+2]);if(p.putImageData(t,0,0),e.showBars){let t=4,r=5,n=(m-S.length*t)/S.length,c=200,a=100;p.save(),p.fillStyle="rgba(255,255,255,0.50)",p.strokeStyle="rgba(0,0,0,0.50)";for(let l=0;l<S.length;l++)e.invInterp?(p.fillRect(-3+r+l*(n+t),a+S[l]-120,n,c),p.strokeRect(-3+r+l*(n+t),a+S[l]-100,n,c)):(p.fillRect(-3+r+l*(n+t),a+256-S[l]-120,n,c),p.strokeRect(-3+r+l*(n+t),a+256-S[l]-100,n,c));p.restore()}if(b.draw(p,S,e),t=p.getImageData(0,0,m,h),r=t.data,n=r.length,c=t.width,e.showInvert)for(let e=0;e<n;e+=4){let t=r[e],n=r[e+1],c=r[e+2];r[e]=255-t,r[e+1]=255-n,r[e+2]=255-c}if(e.showEmboss)for(let e=0;e<n;e++)e%4!=3&&(r[e]=127+2*r[e]-r[e+4]-r[e+4*c]);p.putImageData(t,0,0)})(F);let e=new Uint8Array(c.fftSize/2);c.getByteFrequencyData(e),e.reduce(((e,t)=>e+t)),c.fftSize,Math.min(...e),Math.max(...e),e[11]};window.onload=()=>{(()=>{var e;!function(){const e=new XMLHttpRequest;e.onload=e=>{const t=e.target.responseText,r=JSON.parse(t);let n;document.querySelector("title").innerHTML=r.title,document.querySelector("#warning").innerHTML=r["distortion-warning"];for(let e=0;e<r.files.length;e++)n+=0==e?`<option value="${r.files[e]}" selected>${r.tracks[e]}</option>`:`<option value="${r.files[e]}">${r.tracks[e]}</option>`;document.querySelector("#track-select").innerHTML=n},e.open("GET","data/av-data.json"),e.send()}(),e=I.sound1,window.AudioContext||window.webkitAudioContext,t=new AudioContext,r=new Audio,v(e),n=t.createMediaElementSource(r),c=t.createAnalyser(),c.fftSize=d.numSamples,a=t.createGain(),a.gain.value=d.gain,l=t.createBiquadFilter(),l.type="highshelf",o=t.createBiquadFilter(),o.type="lowshelf",s=t.createWaveShaper(),n.connect(s),s.connect(l),l.connect(o),o.connect(c),c.connect(a),a.connect(t.destination),L=60;let u=window.matchMedia("(max-height: 94.55vw)");H(u),r.addEventListener("ended",(()=>{document.querySelector("#play-button").setAttribute("data-playing","no")})),document.querySelector("#squares-cb").addEventListener("change",(e=>{e.target.checked?(document.querySelector("#square-angle").style.display="flex",document.querySelector("#vortex").style.display="flex",u.matches&&(document.querySelector("#switch-div").style.transform="translate(0, 0vw)")):(u.matches&&(document.querySelector("#switch-div").style.transform="translate(0, 5.5vw)"),document.querySelector("#vortex").style.display="none",document.querySelector("#square-angle").style.display="none")})),u.addEventListener("change",(()=>{H(u)}));let i=document.querySelector("canvas");z(i),R(i,c),B()})()}})();